# Climatiq

The `Climatiq` plugin empowers users to input details related to a Climatiq API. This information serves to automatically populate usage metrics within your manifest. These metrics will undergo initial calculation by AwsImporter. Ultimately, the aim is to compute energy and carbon impacts.

### 1. Add credentials to `.env`

To utilize `Climatiq`, the prerequisite is setting up AwsImporter initially. Ensure that you already possess an .env file containing AwsImporter credentials. Additionally, you'll need to append another key-value pair for your `Climatiq` credentials, adhering to a specified format. For instance:

```txt
CLIMATIQ_API_KEY=your_api_key
```

Replace your_api_key with your actual Climatiq API key. Remember to keep this file secure and never expose it publicly, as it contains sensitive information that grants access to your AWS resources.

## Node config

- `use-energy-sum`: Setting determines whether to calculate and utilize the sum of energy usage across all resources
- `use-carbon-sum`: Setting specifies whether to compute and utilize the sum of carbon emissions across all resources
- `include-carbon-emissions`: Indicates whether to incorporate carbon emissions data in the calculations.
- `include-carbon-intensity`: Determines whether to include carbon intensity data in the computations.

## Inputs

The provided manifest configures the `climatiq` plugin within an example setup. It begins with initializing necessary plugins such as `aws-importer` and `group-by` before specifying the `climatiq-plugin` for calculating energy and carbon impacts. There are two required inputs:

- `timestamp`: Provide an ISO8601 `timestamp` representing the beginning of your observation period. By adding the `duration` to this initial `timestamp`, we determine the end time of your observation period.
- `duration`: Specify the `duration` of your observation period in seconds. This `duration` value is added to the `timestamp` to calculate the end time of your observation period.

Plugin initialization details:

- `aws-importer`: Configured to gather AWS data, including EC2 and EBS services, with specific settings such as tag, location, and observation frequency.
- `group-by`: Utilized to group data based on cloud service.

The data processing pipeline involves:

- `aws-importer`: Collects AWS usage data.
- `group-by`: Groups the collected data based on cloud service.
- `climatiq-plugin`: Calculates energy and carbon impacts, considering settings such as energy and carbon sum, carbon emissions inclusion, and carbon intensity inclusion.

This setup ensures that AWS data is first collected, then grouped, and finally passed to the `climatiq` plugin for calculating energy and carbon impacts. Below is an example of how a fully configured manifest:

```yaml
name: climatiq
description: example manifest utilizing the climatiq plugin
tags: null
initialize:
  plugins:
    aws-importer:
      method: AwsImporter
      path: 'aws-importer'
      global-config:
        aws-importer:
          tag: 'GreenSoftware'
          location: eu-central-1
          aws-services: 'ec2, ebs'
          aws-observation: 60
        metric:
          cloudwatch-namespace: 'TOS_AMI_CloudwatchAgentMetrics'
          client-namespace: 'AWS/EC2'
    group-by:
      path: builtin
      method: GroupBy
    climatiq-plugin:
      method: ClimatiqCalculator
      path: climatiq-plugin
      global-config:
        use-energy-sum: true
        use-carbon-sum: true
        include-carbon-emissions: true
        include-carbon-intensity: true
  outputs: ['yaml']
tree:
  children:
    child:
      pipeline:
        - aws-importer
        - group-by
        - climatiq-plugin
      config:
        group-by:
          group:
          - cloud/service
      inputs:
        - timestamp: '2024-03-26T14:08:00.000Z'
          duration: 3600
```

Inputs explanation:

The provided inputs ensure the collection of AWS metrics over a defined period. Specifically, the data collection duration spans 3600 seconds (1 hour), commencing at 14:08 UTC on 26th March 2024.

This comprehensive setup enables precise monitoring and analysis of AWS resource utilization to derive insights into energy consumption and carbon emissions.

Execute the following command from the project root to run the unit tests
```sh
npm run test-climatiq
```

## Outputs

The `Climatiq` plugin will use the grouped data from `aws-importer` in your `manifest` by adding the following details:

- `energy`: Denotes the energy consumption associated with the specified resource, measured in kilowatt-hours (kWh)
- `carbon`: Represents the carbon emissions generated by the specified resource, measured in metric tons of CO2 equivalent
- `carbon-intensity`: Signifies the carbon intensity, indicating the amount of carbon emissions produced per unit of energy consumed, measured in grams of CO2 equivalent per kilowatt-hour (gCO2e/kWh)

The outputs will return grouped `ec2` and `ebs` results like following example:

```yaml
ec2:
  outputs:
    - timestamp: '2024-03-26T14:08:00.000Z'
      duration: 3600
      location: eu-central-1
      geolocation: 50.1213155,8.471759
      cloud/vendor: aws
      cloud/service: ec2
      cloud/instance-type: t2.micro
      memory/utilization: 0.9272994995117188
      cpu/utilization: 0.6914698759172085
      energy: 0.0034837277456323274
      carbon: 0.0013502
      carbon-intensity: 387.573340566809
ebs:
  outputs:
    - timestamp: '2024-03-26T14:08:00.000Z'
      duration: 3600
      location: eu-central-1
      geolocation: 50.1213155,8.471759
      cloud/vendor: aws
      cloud/service: ebs
      storage/type: ssd
      storage/capacity: 8
      energy: 0.0000109
      carbon: 0.000004224
      carbon-intensity: 387.52293577981646
```

Executing the following command from the project root:

```sh
npm install
ie --manifest ./examples/manifests/climatiq.yml --output ./examples/manifests/climatiq-computed.yml
```

The results will be saved to a new `yaml` file in `./examples/manifests`.
